<div class="config-validator-overlay" (click)="onOverlayClick($event)">
  <div class="config-validator-modal" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="validator-header">
      <div class="header-content">
        <div class="title-section">
          <h2 class="validator-title">
            <span class="status-icon" [class]="'status-' + overallStatus">
              {{ overallStatus === 'success' ? '‚úì' : '‚úó' }}
            </span>
            Configuration Validation Results
          </h2>
          <p class="form-name">{{ formName }}</p>
        </div>
        <button class="close-button" (click)="onClose()" aria-label="Close">
          <span class="close-icon">√ó</span>
        </button>
      </div>
    </div>

    <!-- Summary Cards -->
    <div class="summary-section">
      <div class="summary-cards">
        <div class="summary-card total">
          <div class="card-number">{{ summary.total }}</div>
          <div class="card-label">Total Fields</div>
        </div>
        <div class="summary-card valid">
          <div class="card-number">{{ summary.valid }}</div>
          <div class="card-label">Valid</div>
        </div>
        <div class="summary-card invalid">
          <div class="card-number">{{ summary.invalid }}</div>
          <div class="card-label">Invalid</div>
        </div>
        <div class="summary-card missing">
          <div class="card-number">{{ summary.missing }}</div>
          <div class="card-label">Missing</div>
        </div>
        <div class="summary-card hidden">
          <div class="card-number">{{ summary.hidden }}</div>
          <div class="card-label">Hidden</div>
        </div>
      </div>
    </div>

    <!-- Debug Mode Toggle -->
    <div class="debug-section" *ngIf="parsedData && schema">
      <button class="debug-toggle" (click)="toggleDebugMode()" [class.active]="debugMode">
        <span class="debug-icon">üêõ</span>
        {{ debugMode ? 'Hide' : 'Show' }} Debug Info
      </button>
    </div>

    <!-- Debug Information -->
    <div class="debug-info" *ngIf="debugMode && debugInfo.length > 0">
      <h3>Debug Information</h3>
      <div class="debug-table">
        <div class="debug-row header">
          <div class="debug-cell">Field</div>
          <div class="debug-cell">Value</div>
          <div class="debug-cell">Visible</div>
          <div class="debug-cell">Condition</div>
        </div>
        <div class="debug-row" *ngFor="let item of debugInfo">
          <div class="debug-cell">{{ item.label }}</div>
          <div class="debug-cell">{{ item.value || '(empty)' }}</div>
          <div class="debug-cell" [class]="item.visible ? 'visible' : 'hidden'">
            {{ item.visible ? 'Yes' : 'No' }}
          </div>
          <div class="debug-cell">
            <span *ngIf="item.hasVisibleIf" class="condition-info">
              {{ item.visibleIf | json }}
            </span>
            <span *ngIf="!item.hasVisibleIf" class="no-condition">No condition</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Error Messages -->
    <div class="error-section" *ngIf="validationErrors.length > 0">
      <h3 class="section-title error-title">
        <span class="error-icon">‚úó</span>
        Validation Errors ({{ validationErrors.length }})
      </h3>
      <div class="error-list">
        <div class="error-item" *ngFor="let error of validationErrors">
          <span class="error-text">{{ error }}</span>
        </div>
      </div>
    </div>

    <!-- Warning Messages -->
    <div class="warning-section" *ngIf="warnings.length > 0">
      <h3 class="section-title warning-title">
        <span class="warning-icon">‚ö†</span>
        Warnings ({{ warnings.length }})
      </h3>
      <div class="warning-list">
        <div class="warning-item" *ngFor="let warning of warnings">
          <span class="warning-text">{{ warning }}</span>
        </div>
      </div>
    </div>

    <!-- Field Validation Results -->
    <div class="field-results-section" *ngIf="validationResults.length > 0">
      <!-- Tabs for different field types -->
      <div class="results-tabs">
        <button class="tab-button" 
                [class.active]="activeTab === 'all'"
                (click)="activeTab = 'all'">
          All Fields ({{ validationResults.length }})
        </button>
        <button class="tab-button" 
                [class.active]="activeTab === 'visible'"
                (click)="activeTab = 'visible'">
          Visible Fields ({{ getVisibleFields().length }})
        </button>
        <button class="tab-button" 
                [class.active]="activeTab === 'hidden'"
                (click)="activeTab = 'hidden'">
          Hidden Fields ({{ getHiddenFields().length }})
        </button>
        <button class="tab-button" 
                [class.active]="activeTab === 'errors'"
                (click)="activeTab = 'errors'">
          Errors ({{ getErrorFields().length }})
        </button>
      </div>

      <!-- Field Results -->
      <div class="field-results">
        <div class="field-item" 
             *ngFor="let result of getFilteredResults()"
             [class]="getStatusClass(result.status)">
          <div class="field-header">
            <span class="status-icon" [class]="getStatusClass(result.status)">
              {{ getStatusIcon(result.status) }}
            </span>
            <span class="field-name">{{ result.label }}</span>
            <span class="field-key">({{ result.key }})</span>
          </div>
          <div class="field-message">{{ result.message }}</div>
          <div class="field-value" *ngIf="result.key && parsedData[result.key] !== undefined">
            <strong>Value:</strong> {{ parsedData[result.key] }}
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="validator-footer">
      <button class="close-btn" (click)="onClose()">
        Close
      </button>
    </div>
  </div>
</div>
